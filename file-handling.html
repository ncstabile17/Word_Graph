<html>
    <head>
      <title>Line Chart</title>
    <script src="chart.js/dist/Chart.bundle.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="string-handling.js" ></script>
    

    <style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
    
    </head>
    <body>
      <div style="width:75%;">
        <canvas id="canvas"></canvas>
    </div>
    <input type='file' accept='text/plain' onchange='openFile(event)'><br>
    <div id='output'>
    </div>
    <div>
    <form>
      Enter words separated by a comma: <br>
      <input type="text" value="Frankenstein" id="input">
      <br>
    </form>
    </div>
    <div id='words'>
    </div>
    <div id='maxWords'></div>

    <script>
        var randomColorFactor = function() {
            return Math.round(Math.random() * 255);
        };
        var randomColor = function(opacity) {
            return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',' + (opacity || '.3') + ')';
        };

      var openFile = function(event) {
        var input = event.target;

        var reader = new FileReader();
        reader.onload = function(){
          var str = reader.result;

          //chapArray is an array where each element
          //is an array containing the words in that chapter
          //chapters is a string array with each word being its own element
          var chapArray = str.toLowerCase().split(/chapter/);
          var chapters = new Array(chapArray.length);
          
          chapArray.forEach(function (element, index, array) {
            chapters[index] = element.replace(/[^a-zA-Z '\n]/g, '').split(/\s+/);
          })
          

          var xLabels = [];
          for (var i = 0; i<chapArray.length; i++)
          {
            var current = "Chapter " + i;
            xLabels.push(current);
          }

          
          var node = document.getElementById('output');
          //node.innerText = "Chapter One array: " + chapters[1];
          var strArray = chapters[1];
          //var wordCount = countWords(strArray);
          //printMaxNoCommon(wordCount.count, wordCount.words);

          var wordInput = document.getElementById('input').value;
          wordInput = wordInput.toString().toLowerCase().split(/,/);

          console.log(wordInput);
          var wordTotal = 0;
          var datasets = [];

          wordInput.forEach(function(element, index, array) {
            var wordData = [];
            chapters.forEach(function(element2, index2, array2) {
              var wordCount = countWords(array2[index2]);
              var idx = wordCount.words.indexOf(element);
              if (idx != -1) {
                var numCount = wordCount.count[idx];
                wordData.push(numCount);

              }
              else {
                wordData.push(0);
              }
            })

            for (var j = 0; j<wordData.length; j++) {

             var currNum = Number(wordData[j]);
             wordTotal += currNum;
            }

            var newDataset = {
                label: element,
                borderColor: randomColor(0.4),
                pointBorderColor: randomColor(0.7),
                pointBorderWidth: 1,
                data: wordData,
            };

            datasets.push(newDataset);
            console.log(datasets);

              //console.log(wordTotal);
              
              

          })

            makeGraph(xLabels, datasets);

          
          

          
        };
        reader.readAsText(input.files[0]);


        
      };




function makeGraph(xLabels, datasets) {

     // var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        var config = {
            type: 'line',
            data: {
                labels: xLabels,
                datasets: datasets
            },
            options: {
                responsive: true,
                title:{
                    display:true,
                    text:'Chart.js Line Chart'
                },
                tooltips: {
                    mode: 'label',
                    callbacks: {
                        // beforeTitle: function() {
                        //     return '...beforeTitle';
                        // },
                        // afterTitle: function() {
                        //     return '...afterTitle';
                        // },
                        // beforeBody: function() {
                        //     return '...beforeBody';
                        // },
                        // afterBody: function() {
                        //     return '...afterBody';
                        // },
                        // beforeFooter: function() {
                        //     return '...beforeFooter';
                        // },
                        // footer: function() {
                        //     return 'Footer';
                        // },
                        // afterFooter: function() {
                        //     return '...afterFooter';
                        // },
                    }
                },
                hover: {
                    mode: 'dataset'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Chapter'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Number of Times Used'
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 20,
                        }
                    }]
                }
            }
        };
        
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myLine = new Chart(ctx, config);
            window.myLine.update();
        

 }

 //window.onload = makeGraph;


    </script>
    </body>
    </html>