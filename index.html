<html>
    <head>
      <title>Line Chart</title>
    <script src="chart.js/dist/Chart.bundle.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="string-handling.js" ></script>
    

    <style>
    .center {
      margin: auto;
      text-align: center;
    }
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
    
    </head>
    <body>
      <div style="width:97%;">
        <canvas id="canvas" ></canvas>
    </div>
  <div class="center">
    <h1> Welcome to the Frankenstein Word Graph! </h1>
    <p> To begin, please select a text file of a book containing chapters: <br> </p>
    <input type='file' accept='text/plain' id="inputFile" multiple><br> <br>
    <div>
    <form>
      Enter the word(s) you'd like to graph: <br><br>
      <input type="text" value="Frankenstein" id="wordInput">
      <br>
    </form>
    <div id="numWords"></div><br>
    </div>
        <button onclick="getGraph()"> Click to graph words! </button>
        <div id="error"></div><br>

    <form>
      Enter maximum number of words you'd like to see: <br><br>
      <input type="text" value="10" id="maxInput">
      <br>
      And for which chapter (enter all for whole book): 
      <input type="text" value="4" id="chapInput">
      <br>
    </form>
    <button onclick="showMax()"> Click for Max Words! </button>
    <div id="maxWords"></div>
  </div>
    

    <script>

    function getGraph() {
      document.getElementById('numWords').innerText = '';

      console.log("In getGraph...");
        var randomColorFactor = function() {
            return Math.round(Math.random() * 255);
        };
        var randomColor = function(opacity) {
            return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',' + (opacity || '.3') + ')';
        };

        var input = document.getElementById('inputFile').files[0];

        var reader = new FileReader();
        reader.onload = function(){
          var str = reader.result;

          //chapArray is an array where each element
          //is an array containing the words in that chapter
          //chapters is a string array with each word being its own element
          var chapArray = str.split(/CHAPTER/);
          console.log(chapArray);
          //console.log(chapArray);
          var chapters = new Array(chapArray.length);
          
          chapArray.forEach(function (element, index, array) {
            chapters[index] = element.toLowerCase().replace(/[^a-zA-Z '\n]/g, '').split(/\s+/);
          })
          

          var xLabels = [];
          for (var i = 0; i<chapArray.length; i++)
          {
            var current = "Chapter " + i;
            xLabels.push(current);
          }

          function getArray() {

            var strArray = [];

              for (var t = 0; t < chapters.length; t++) {
                  strArray = strArray.concat(chapters[t]);
              }

              return strArray;
      
           }

          

          var wordInput = document.getElementById('wordInput').value;
          wordInput = wordInput.toString().toLowerCase().split(/, */);

          console.log(wordInput);
          
          var datasets = [];

          wordInput.forEach(function(element, index, array) {
            var wordTotal = 0;
            var wordData = [];
            chapters.forEach(function(element2, index2, array2) {
              var wordCount = countWords(array2[index2]);
              var idx = wordCount.words.indexOf(element);
              if (idx != -1) {
                var numCount = wordCount.count[idx];
                wordData.push(numCount);

              }
              else {
                wordData.push(0);
              }
            })

            for (var j = 0; j<wordData.length; j++) {

             var currNum = Number(wordData[j]);
             wordTotal += currNum;
            }

            var newDataset = {
                label: element,
                borderColor: randomColor(0.4),
                pointBorderColor: randomColor(0.7),
                pointBorderWidth: 1,
                data: wordData,
            };

            datasets.push(newDataset);
            console.log(datasets);

              document.getElementById('numWords').innerText += element + ": " + wordTotal + " appearances\n";
              
              

          })


            makeGraph(xLabels, datasets);

          
          

          
        };
        if (input != null) {
          reader.readAsText(input);

          }

        else {
          document.getElementById('error').innerText = "Please select a text file";
        }
        
      };

function showMax() {
    var strArray = getArray();
    var wordCount = countWords(strArray);
    printMaxNoCommon(wordCount.count, wordCount.words, 50);
}



function makeGraph(xLabels, datasets) {

        var config = {
            type: 'line',
            data: {
                labels: xLabels,
                datasets: datasets
            },
            options: {
                responsive: true,
                title:{
                    display:true,
                    text:'Chronological Word Graph'
                },
                tooltips: {
                    mode: 'label',
                    callbacks: {
                        // beforeTitle: function() {
                        //     return '...beforeTitle';
                        // },
                        // afterTitle: function() {
                        //     return '...afterTitle';
                        // },
                        // beforeBody: function() {
                        //     return '...beforeBody';
                        // },
                        // afterBody: function() {
                        //     return '...afterBody';
                        // },
                        // beforeFooter: function() {
                        //     return '...beforeFooter';
                        // },
                        // footer: function() {
                        //     return 'Footer';
                        // },
                        // afterFooter: function() {
                        //     return '...afterFooter';
                        // },
                    }
                },
                hover: {
                    mode: 'dataset'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Chapter'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Number of Times Used'
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 5,
                        }
                    }]
                }
            }
        };
        
            var ctx = document.getElementById("canvas").getContext("2d");
            //ctx.translate(500,500);
            window.myLine = new Chart(ctx, config);
           // ctx.translate(0,100);
            window.myLine.update();
        

 }

 //window.onload = makeGraph;


    </script>

    </body>
    </html>